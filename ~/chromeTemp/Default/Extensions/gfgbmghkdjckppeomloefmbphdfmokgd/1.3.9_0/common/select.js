!function(t){function e(t){return t.toString().trim()}function n(t,e){return function(n){t(n,e)}}function o(t){for(var e=["direction","font-family","font-size","font-size-adjust","font-variant","font-weight","font-style","letter-spacing","line-height","text-align","text-indent","text-transform","word-wrap","word-spacing"],n="white-space:pre;padding:0;margin:0;",o=0;o<e.length;o++){var i=e[o];n+=i+":"+t.getPropertyValue(i)+";"}return n}function i(t){if("true"===t.contentEditable)return!0;for(;t=t.parentNode;)if("true"===t.contentEditable)return!0;return!1}function r(t){return"INPUT"===t.tagName&&l.indexOf(t.type)>-1}function s(t,e){for(;t&&t.parentNode;){if(t===e)return!0;t=t.parentNode}return!1}window;var l=["text","tel","url"],c=function(){this._lastSelectionText=this.getText(),this.onSelect=new Notifier,this.onDeselect=new Notifier;var t=this._checkSelection.bind(this);document.addEventListener("mouseup",t,!1),document.addEventListener("keyup",t,!1),document.addEventListener("contextmenu",t,!1),document.addEventListener("select",t,!1),this.listActivedFrameDocuments=[],this.listFuncListeners=[],window.addEventListener("load",function(){for(var e=document.querySelectorAll("iframe"),o=0;o<e.length;o++)if(e[o].contentDocument){var i=n(t,e[o]);this.listActivedFrameDocuments.push(e[o].contentDocument),this.listFuncListeners.push(i),e[o].contentDocument.addEventListener("mouseup",i,!1),e[o].contentDocument.addEventListener("keyup",i,!1),e[o].contentDocument.addEventListener("contextmenu",i,!1),e[o].contentDocument.addEventListener("select",i,!1)}}.bind(this),!1),window.addEventListener("beforeunload",function(){for(var t=0;t<this.listActivedFrameDocuments.length;t++)this.listActivedFrameDocuments[t].removeEventListener("mouseup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("keyup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("contextmenu",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("select",this.listFuncListeners[t],!1);this.listActivedFrameDocuments=[],this.listFuncListeners=[]}.bind(this),!1)};c.prototype={constructor:c,_checkSelection:function(t,n){if(Utils.getNearest(t.target,".corom-element")&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),Utils.getNearest(t.target,".corom-element")||"keyup"===t.type&&"input"!==t.target.tagName.toLowerCase()&&"textarea"!==t.target.tagName.toLowerCase()&&!t.target.isContentEditable)return this.onDeselect.trigger(!0),!0;"mouseup"===t.type&&(this._lastMouseupEvent=t),this.contextElement=n;var o=this.getContextWindow().getSelection(),l=e(o),c=Utils.getElement(o.focusNode);if(l&&this._lastSelectionText===l&&(o.containsNode(t.target,!0)||s(t.target,c)||s(c,t.target)))return"contextmenu"!==t.type&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),this.onDeselect.trigger(!0),!0;if(l&&"contextmenu"===t.type)this._lastSelectionText=this._lastContextMenu||this._lastSelectionText;else if(this.onDeselect.trigger(),l){var a=this.getSelectionCoords(o),d="select"===t.type?t.target:c;if(!a&&"select"===t.type){var g=t.target,u="text";g&&("TEXTAREA"===g.tagName||r(g))&&g.selectionStart!=g.selectionEnd&&(a=this.getTextBoundingRect(g,g.selectionStart,g.selectionEnd),u="input",d=g),t.detail=this._lastMouseupEvent.detail}if("input"!==u&&(u=i(d)?"input":"notInput"),a){this._lastSelectionText=l;var h=this.getSelectionStyle(Utils.getElement(d)),p=this.getContextWindow().getComputedStyle(Utils.getElement(d)).getPropertyValue("zoom");p=p?parseInt(p):1,a.right+=this.getContextPositionLeft(),a.left+=this.getContextPositionLeft(),a.top+=this.getContextPositionTop(),a.bottom+=this.getContextPositionTop(),a.left*=p,a.right*=p,a.top*=p,a.bottom*=p,a.height*=p,a.width*=p,this.onSelect.trigger({element:t.target,text:l,coords:a,style:h,source:u,detail:t.detail})}}else this._lastSelectionText=null},getContextWindow:function(){return this.contextElement?this.contextElement.contentWindow:window},getContextDocument:function(){return this.contextElement?this.contextElement.contentDocument:document},getContextPositionTop:function(){return this.contextElement?this.contextElement.getBoundingClientRect().top:0},getContextPositionLeft:function(){return this.contextElement?this.contextElement.getBoundingClientRect().left:0},getCoords:function(){return this.getSelectionCoords(this.getContextWindow().getSelection())},getStyle:function(){return this.getSelectionStyle(this.getContextWindow().getSelection())},getText:function(){return e(this.getContextWindow().getSelection())},getBoundTop:function(t){var e=t.getBoundingClientRect(),n=this.getContextWindow().getComputedStyle(t);return e.top+t.clientTop+parseInt(n["padding-top"])||0},getSelectionStyle:function(t){var e=Utils.getElement(t);if(!e)return{background:"highlight"};var n=this.getContextWindow().getComputedStyle(e).backgroundColor,o=this.getContextWindow().getComputedStyle(e,"::selection"),i=parseInt(o.lineHeight),r=i,s=o.backgroundColor,l=o.color,c=this.getContextWindow().navigator.userAgent.match(/Windows/i);return"rgba(0, 0, 0, 0)"!==s&&s!==n||(s=c?"#328efe":"highlight"),isNaN(r)&&(r=1.14*parseInt(o.fontSize)),{lineHeight:i,assumedLineHeight:r,background:s,color:l}},getElementOffset:function(t){var e=this.getContextDocument().body,n=this.getContextDocument().documentElement,o=this.getContextDocument().createElement("div");o.style.paddingLeft=o.style.width="1px",e.appendChild(o);var i=2==o.offsetWidth;e.removeChild(o),o=t.getBoundingClientRect();var r=n.clientTop||e.clientTop||0,s=n.clientLeft||e.clientLeft||0,l=this.getContextWindow().pageYOffset||i&&n.scrollTop||e.scrollTop,c=this.getContextWindow().pageXOffset||i&&n.scrollLeft||e.scrollLeft;return{top:o.top+l-r,left:o.left+c-s}},getTextBoundingRect:function(t,e,n,i){if(!(t&&"value"in t))return null;if(e>=n)return null;var r=this.getContextWindow().getComputedStyle(t),s=this.getElementOffset(t),l=s.top,c=s.left,a=parseFloat(r.width),d=parseFloat(r.height);l+=parseFloat(r["padding-top"]),l+=parseFloat(r["border-top-width"]),c+=parseFloat(r["padding-left"]),c+=parseFloat(r["border-left-width"]),c+=1;var g=o(r),u=t.value,h=u.length,p=this.getContextDocument().createElement("div");e>0&&this.appendSpanElement(p,g,u.substring(0,e));var m=this.appendSpanElement(p,g,u.substring(e,n));h>n&&this.appendSpanElement(p,g,u.substring(n,h)),p.style.cssText=g,p.style.position="absolute",p.style.top=l+"px",p.style.left=c+"px",p.style.width=a+"px",p.style.height=d+"px",this.getContextDocument().body.appendChild(p);var f=m.getBoundingClientRect();return f={bottom:f.bottom,top:f.top,height:f.height,left:f.left,right:f.right,width:f.width},f.left-=t.scrollLeft,f.right-=t.scrollLeft,f.bottom-=t.scrollTop,f.top-=t.scrollTop,i||p.parentNode.removeChild(p),f},appendSpanElement:function(t,e,n){var o=this.getContextDocument().createElement("span");return o.style.cssText=e,o.textContent=n,t.appendChild(o),o},getSelectionCoords:function(t){if(t.rangeCount){var e=t.getRangeAt(t.rangeCount-1),n=this.getSelectionStyle(t);return this.getCorrectedRangeRect(e,n)}return null},getCorrectedRangeRect:function(t,e){var n,o=t.getBoundingClientRect();if(o.width&&o.height){var i=e.lineHeight,r=t.endContainer.parentElement,s=this.getBoundTop(Utils.getElement(r));return n=o.bottom-s<1.5*e.assumedLineHeight?s:i?o.bottom-i:o.top,{left:o.left,right:o.right,top:n,bottom:o.bottom,height:o.bottom-n,width:o.width}}}},"undefined"==typeof PRODUCTION&&(c.prototype.__drawRect=function(t,e){var n="rgb("+[192*Math.random()|0,192*Math.random()|0,192*Math.random()|0].join(",")+")";node=Utils.html({style:{boxSizing:"border-box",border:"1px dotted "+n,zIndex:2147483647,position:"absolute",left:t.left+"px",top:this.getContextDocument().body.scrollTop+t.top+"px",height:t.bottom-t.top+"px",width:t.width+"px",fontWeight:"bold",overflow:"hidden",opacity:.6,color:n},text:""+e}),this.getContextDocument().body.appendChild(node)},c.prototype.__drawElementBounds=function(t,e){var n=(t=Utils.getElement(t)).getBoundingClientRect();this.__drawRect(n,e)},c.prototype.__drawSeletionBounds=function(){var t=this.getContextWindow().getSelection();if(t.rangeCount){for(var e=this.getSelectionStyle(selection),n=0;n<t.rangeCount;++n){for(var o=(r=t.getRangeAt(n)).getClientRects(),i=0;i<o.length;++i)this.__drawRect(o[i],"r"+n+","+i),this.__drawRect(this.getCorrectedRangeRect(o[i],e),"r"+n+","+i+"c");this.__drawRect(r.getBoundingClientRect(),"b"+n+","),this.__drawElementBounds(r.commonAncestorContainer,"r"+n+"A")}var r=t.getRangeAt(t.rangeCount-1);return this.getCorrectedRangeRect(r,e)}}),window.selection=new c}("undefined"==typeof global?global={}:global);