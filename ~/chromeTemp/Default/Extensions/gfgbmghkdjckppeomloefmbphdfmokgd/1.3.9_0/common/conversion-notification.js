"undefined"==typeof global?global={}:global,function(){function e(e){var o=e.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:o.top+i,left:o.left+t,width:o.width,height:o.height}}var o=chrome.i18n.getMessage;if(window===window.top){var t={USER_IGNORED:"user_ignored",ALREADY_USE:"already_use",TRY_NOW:"try_now"},i=null,n={amazon:{url_regex:/www\.amazon\.com/,price_selector:"#priceblock_ourprice, #priceblock_dealprice"},ebay:{url_regex:/ebay\.com/,price_selector:"#prcIsum"},alibaba:{url_regex:/www\.alibaba\.com/,price_selector:".ma-ref-price, .ma-spec-price"},aliexpress:{url_regex:/aliexpress\.com/,price_selector:"div > #j-sku-discount-price, div > #j-sku-price"},zara:{url_regex:/zara\.com(?!(?:\/vn))/,price_selector:".price._product-price"},hm:{url_regex:/hm\.com/,price_selector:".price-value"},uniqlo:{url_regex:/uniqlo\.com/,price_selector:"#price, .price-sales.pdp-space-price"},rakuten:{url_regex:/rakuten\.co\.jp/,price_selector:".price2"},banggood:{url_regex:/banggood\.com/,price_selector:".item_now_price, .item_old_price"},gearbest:{url_regex:/gearbest\.com/,price_selector:".goodsIntro_promoPrice > .goodsIntro_priceWrap > .goodsIntro_price, .goodsIntro_priceWrap > .goodsIntro_price"},1688:{url_regex:/detail\.1688\.com\/offer\/\d+\.html/,price_selector:"span.price-now, .price-original-sku > span.value, .price span.value"},dmm:{url_regex:/dmm\.com/,price_selector:".now-result, .price"},taobao:{url_regex:/taobao\.com/,price_selector:"#J_StrPrice"},tmall:{url_regex:/tmall\.com/,price_selector:".tm-price"}},r=function(){this._isShown=!1};r.prototype={constructor:r,_init:function(){this._tooltipNode=this._createNotiTooltipNode(),this._tooltipNode&&(this._waveNode=this._createWaveNode(),window.addEventListener("mousedown",function(e){Utils.getNearest(e.target,".corom-element")?e.stopPropagation():this._isShown&&(this._reportOnboardingClick("out"),this._destroy(t.USER_IGNORED))}.bind(this),!1),window.popup._shadowRoot.appendChild(this._tooltipNode),this._waveNode&&window.popup._shadowRoot.appendChild(this._waveNode),document.documentElement.appendChild(popup._rootNode,document.body))},_createNotiTooltipNode:function(){var e=options.get("tooltip_notification");if(!e)return null;var i=document.createElement("div");return i.classList.add("conversion-notification"),i.classList.add("hidden"),i.innerHTML=Mustache.render(e,{conversion_noti_header:o("conversion_noti_header"),conversion_noti_message:o("conversion_noti_message"),conversion_btn_already:o("conversion_btn_already"),conversion_btn_try:o("conversion_btn_try")}),i.addEventListener("click",function(e){switch(e.target.id){case"noti_btn_close":this._reportOnboardingClick("close"),this._destroy(t.USER_IGNORED);break;case"noti_btn_already":this._reportOnboardingClick("already"),this._destroy(t.ALREADY_USE);break;case"noti_btn_try":this._reportOnboardingClick("try"),this._destroy(t.TRY_NOW)}}.bind(this)),i},_createWaveNode:function(){var e=options.get("tooltip_wave_focusing");if(!e)return null;var o=document.createElement("div");return o.classList.add("tooltip-wave-wrapper"),o.classList.add("hidden"),o.innerHTML=e,o},_setPosition:function(o){var t=e(o),i=window.innerWidth;this._tooltipNode.style.top=t.top-136-10+"px";var n=t.left+(window.location.hostname.includes("dmm.com")?50:0);n+352+20>i&&(n=i-20-352),this._tooltipNode.style.left=n+"px",this._tooltipNode.classList.remove("hidden"),this._waveNode.style.top=t.top+t.height/2-5+"px";var r=t.left+(window.location.hostname.includes("dmm.com")?70:20);this._waveNode.style.left=r+"px",this._waveNode.classList.remove("hidden"),this._tooltipNode.style.setProperty("--triangleLeft",r-n+5+"px")},show:function(){this._init(),this._posInterval=setInterval(this._relocatePosition.bind(this),1e3)},_relocatePosition:function(){if(options.get("conversion_notification_disabled"))this._destroy();else{var e=Utils.query(i);if(e&&(e=Utils.query(i))){this._setPosition(e);var o=Utils.query(".sufei-dialog");o&&"none"!==o.style.display&&(window.location.hostname.includes("taobao.com")||window.location.hostname.includes("tmall.com"))?(window.popup._rootNode.style.display="none",this._isShown=!1):(window.popup._rootNode.style.display="block",this._isShown=!0)}}},_destroy:function(e){this._isShown&&(this._tooltipNode.classList.add("hidden"),this._waveNode.classList.add("hidden"),this._isShown=!1,this._posInterval&&clearInterval(this._posInterval),options.get("conversion_notification_disabled")||(options.set("conversion_notification_disabled",!0),options.set("conversion_notification_last",Date.now()),options.set("conversion_notification_user",e)))},_reportOnboardingClick:function(e){chrome.runtime.sendMessage({type:"report_onboarding_click",data:{click_type:e}})}},window.conversionNotification=new r;var s=function(e){for(var o=Object.keys(n),t=0;t<o.length;t++)if(e.match(n[o[t]].url_regex))return o[t];return null}(window.location.href);window.addEventListener("DOMContentLoaded",function(){options.get("conversion_notification_disabled")||s&&(i=n[s].price_selector,conversionNotification.show())})}}();