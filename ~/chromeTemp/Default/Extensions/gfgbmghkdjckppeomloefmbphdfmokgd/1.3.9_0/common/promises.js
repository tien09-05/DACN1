!function(s){var t=function(s){if(0===arguments.length)return this._init(),this;if(s instanceof t)return s;var i=new t;return i.resolve(s),i};t.RUNNING=0,t.RESOLVED=1,t.FAILED=2,t.prototype={constructor:t,_init:function(){this._results=[],this._subscribers=[],this.state=t.RUNNING},_notify:function(){var s=this;this._subscribers.forEach(function(t){t.apply(s,s._results)}),this._subscribers=[]},resolve:function(){return this.state=t.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=t.FAILED,this._results=arguments,this._notify(),this},subscribe:function(s){this.state!==t.RUNNING?s.apply(this,this._results):this._subscribers.push(s)},done:function(s){return this.subscribe(s),this},success:function(s){var i=this;return this.subscribe(function(){i.state===t.RESOLVED&&s.apply(i,i._results)}),this},fail:function(s){var i=this;return this.subscribe(function(){i.state===t.FAILED&&s.apply(i,i._results)}),this},bind:function(s){return(s=new t(s)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},t.when=function(){var s=[];return s=Array.isArray(arguments[0])?arguments[0]:Utils.toArray(arguments),new t.When(s)},t.When=function(s){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=t.RUNNING,this._thingsToDo=s.length,this._results=Array(this._thingsToDo),this._init(s)},t.When.prototype={constructor:t.When,_init:function(s){var i=this;s.forEach(function(s,n){(s=new t(s)).subscribe(function(){s.state===t.FAILED&&(i._state=t.FAILED),i._results[n]=Utils.toArray(arguments),i._thingsToDo--,i._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var s=[];this._results.forEach(function(t){s=s.concat(t)}),this._state===t.FAILED?this._runCallbacks(this._failCallbacks,s):this._runCallbacks(this._successCallbacks,s),this._runCallbacks(this._doneCallbacks,s),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(s,t){s.forEach(function(s){s.apply(this,t)})},done:function(s){return this._doneCallbacks.push(s),this._checkIsDone(),this},success:function(s){return this._successCallbacks.push(s),this._checkIsDone(),this},fail:function(s){return this._failCallbacks.push(s),this._checkIsDone(),this}},t.chain=function(){function s(i){if(!i.length)return n.resolve.apply(n,e);var r=i.shift();"function"==typeof r?t(r()).done(function(t){e.push(t),s(i)}):(e.push(r),s(i))}var i,n=new t,e=[];return i=Array.isArray(arguments[0])?arguments[0]:Utils.toArray(arguments),s(i),n},window.Promise=t}("undefined"==typeof global?global={}:global);