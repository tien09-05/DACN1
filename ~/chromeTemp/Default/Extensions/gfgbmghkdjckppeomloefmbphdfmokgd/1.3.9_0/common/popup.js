!function(t){!function(){function t(t){chrome.runtime.sendMessage({type:"report_small_count",name:"PopupAction",value:t})}var e=function(){this._coords={top:0,left:0,bottom:0,right:0,width:0,height:0},this._isShown=!1,this._isExpanded=!1,this._createNodes(),this.onPopupShow=new Notifier};e.prototype={constructor:e,TRIGGER_INNER_HTML:'<div class="coccoc-tt-icon"></div>                          <div class="coccoc-tt-text">Dá»‹ch</div>',POPUP_INNER_HTML:"{{text}}",HORIZONTAL_GAP:window===window.top?20:0,VERTICAL_GAP:window===window.top?20:0,_createNodes:function(){var t=document.createElement("div");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.right=0,t.style.height=0,t.style.margin=0,t.style.textAlign="left",t.style.zIndex=1e10,t.style.pointerEvents="none",t.style.border="none",t.style.all="initial",t.hidden=!0,t.classList.add("corom-element"),this._rootNode=t;var e=document.createElement("style");e.innerHTML='@import "'+chrome.extension.getURL("css/style.css")+'";',this._shadowRoot=Utils.attachShadow(t),this._shadowRoot.appendChild(e),this._createTriggerNode(),this._createPopupNode(),this._isExpanded=!1,window.addEventListener("pagehide",this._destroy.bind(this)),this._setPopupListener()},_createTriggerNode:function(){var t=document.createElement("div");t.classList.add("corom-trigger"),t.innerHTML=this.TRIGGER_INNER_HTML,t.hidden=!0,t.addEventListener("mouseup",function(t){this.expanded=!0,this.onPopupShow.trigger()}.bind(this),!1),this._triggerNode=t},_createPopupNode:function(){var t=document.createElement("div"),e=document.createElement("div");e.classList.add("corom-popup"),t.appendChild(e),t.style.left=0,t.style.right=0,t.style.pointerEvents="none",t.style.position="absolute",t.style.zIndex="10000000000000",t.hidden=!0,this._popupNode=t,this._popupNodeInner=e},_setText:function(t,e){this._currentTranslation={word:t.word,lang:e},t.incIndex=function(){++window.INDEX||(window.INDEX=1)},t.getIndex=function(){return window.INDEX},t.resetIndex=function(){"zh-CN"!==e&&(window.INDEX=0)},t.initIndex=function(){window.INDEX=0},t.existWriting=function(){return Boolean(t.writing)};var o=options.get("popup_template");this._popupNodeInner.innerHTML=Mustache.render(o,t)},_setPopupListener:function(){this._popupNode.addEventListener("click",function(e){switch(e.target.id){case"btn_speaker":t(o.POPUP_ACTION_SPEAKER),chrome.runtime.sendMessage({type:"speak",word:this._currentTranslation.word,lang:this._currentTranslation.lang},function(t){"end"===t&&this._stopSpeaking()}.bind(this)),e.target.classList.add("btn-disabled");break;case"btn_more":window.open("https://www.coccoc.com/search#query="+this._currentTranslation.word,"_blank"),t(o.POPUP_ACTION_OPENLINK);break;case"btn_close":this.hide(!0);break;case"coccoc-synonym":t(o.POPUP_ACTION_SYNONYM)}}.bind(this))},_setScrollListener:function(){this._popupNodeInner.querySelector(".coccoc-scroll").addEventListener("scroll",function(){this._scrolled||(this._scrolled=!0,t(o.POPUP_ACTION_SCROLL))}.bind(this))},_stopSpeaking:function(){chrome.runtime.sendMessage({type:"stop_speaking"});var t=this._popupNode.querySelector("#btn_speaker");t&&t.classList.remove("btn-disabled")},_setStyle:function(t){var e=Utils.checkDarkPage();this._triggerNode.style.backgroundColor=e?"#fff":"#424242",this._triggerNode.style.setProperty("--triangleColor",this._triggerNode.style.backgroundColor),this._triggerNode.style.color=e?"#424242":"#fff"},_getActualPopupSize:function(){this._isShown||(this._popupNodeInner.style.left="-1000px",this._triggerNode.style.left="-1000px",this._popupNode.hidden=!1,this._shadowRoot.appendChild(this._popupNode));var t={width:this._popupNodeInner.offsetWidth?this._popupNodeInner.offsetWidth:300,height:this._popupNodeInner.offsetHeight?this._popupNodeInner.offsetHeight:250};return this._isShown||(this._popupNode.hidden=!this._isExpanded,this.hide()),t},_destroy:function(){null!==this._triggerNode&&(this._stopSpeaking(),this._triggerNode.remove(),this._popupNode.remove(),this._rootNode.remove(),this._shadowRoot=null,this._triggerNode=null,this._popupNode=null,this._popupNodeInner=null,this._rootNode=null)},get isShown(){return this._isShown},get coords(){return this._coords},set coords(t){var e=document.scrollingElement.scrollTop||window.pageYOffset,o=window.innerHeight,i=window.innerWidth,s=this._getActualPopupSize();t.top+s.height+this.VERTICAL_GAP>o?this._popupNode.style.top=t.top+e-s.height+"px":this._popupNode.style.top=t.top+t.height+e+"px",t.top-45>=0?(this._triggerNode.style.top=t.top+e-44-1+"px",this._triggerNode.classList.remove("coccoc-triangle-top"),this._triggerNode.classList.add("coccoc-triangle-bottom")):(this._triggerNode.style.top=t.top+e+t.height+8+1+"px",this._triggerNode.classList.remove("coccoc-triangle-bottom"),this._triggerNode.classList.add("coccoc-triangle-top")),this._triggerNode.style.setProperty("--triangleLeft","50%"),this._triggerNode.style.left=t.right-t.width/2-44+"px";var n=Math.max(t.left+s.width+this.HORIZONTAL_GAP-i,0);this._popupNodeInner.style.left=Math.max(t.left-n,this.HORIZONTAL_GAP)+"px",this._coords=t},get expanded(){return this._isExpanded},set expanded(t){this._isExpanded=t,setTimeout(function(){this._triggerNode.hidden=t,this._popupNode.hidden=!t,this._rootNode.hidden=!1}.bind(this),0)},show:function(t){this._setText(t.data,t.lang),this.coords=t.coords,this._setStyle(t.style),this._injected||(this._shadowRoot.appendChild(this._popupNode),this._shadowRoot.appendChild(this._triggerNode),document.documentElement.appendChild(this._rootNode),this._injected=!0),this.expanded=Boolean(t.expand),this._isShown=!0,this._scrolled=!1,setTimeout(function(){this._setScrollListener()}.bind(this),0)},hide:function(t){(t||this._isShown)&&(this._stopSpeaking(),this._isExpanded=!1,this._triggerNode.hidden=!0,this._popupNode.hidden=!0,this._isShown=!1)}},window.popup=new e,document.addEventListener("mousedown",function(t){Utils.getNearest(t.target,".corom-element")?t.stopPropagation():window.popup.isShown&&window.popup.hide()},!1),contentScript();var o={POPUP_ACTION_SPEAKER:0,POPUP_ACTION_OPENLINK:1,POPUP_ACTION_SYNONYM:2,POPUP_ACTION_SCROLL:3}}()}("undefined"==typeof global?global={}:global);