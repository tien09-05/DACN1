!function(t){function e(t){for(var e=this;e&&(!e.matches||!e.matches(t));)e=e.parentNode;return e}function n(t){return t.toString().trim()}function o(t,e){return function(n){t(n,e)}}function i(t){for(var e=["direction","font-family","font-size","font-size-adjust","font-variant","font-weight","font-style","letter-spacing","line-height","text-align","text-indent","text-transform","word-wrap","word-spacing"],n="white-space:pre;padding:0;margin:0;",o=0;o<e.length;o++){var i=e[o];n+=i+":"+t.getPropertyValue(i)+";"}return n}function s(t){if("true"===t.contentEditable)return!0;for(;t=t.parentNode;)if("true"===t.contentEditable)return!0;return!1}function r(t){return"INPUT"===t.tagName&&h.indexOf(t.type)>-1}function c(t,e){for(;t&&t.parentNode;){if(t===e)return!0;t=t.parentNode}return!1}function a(){function t(t){var e=/(?:C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท)\s?[0-9.,]+|[0-9.,]+\s?(?:C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท|MILE PER HOUR|MPH|MILE PER GALLON|MPG|MILES|MI|YARD|YARDS|YD|INCHES|IN|''|”|"|FEET|FEETS|FT|'|POUND|POUNDS|LB|OUNCE|OUNCES|OZ|TAEL|GAL|MPH|MPG|KWH|KW\/H)/g,n=/[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FTS|')?(?:\s?[X*]\s?[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?){1,2}/g,o=(t=t.toUpperCase()).match(n)||t.match(e);return o&&o.length?o[0]:null}function e(t){return t.match(/[^$€¥￥\,\.\d\s円圓元£₩฿원'"]/g)}function n(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():(chrome.runtime.sendMessage({type:"close_popups"}),window.unitConversion&&window.unitConversion.isShown&&window.unitConversion.hide(!1))}function o(t){!function(t){var e={timestamp_ms:t,page_url:window.location.href,type:"dictionary"};chrome.runtime.sendMessage({type:"report_custom_data",value:e})}(Date.now()),s(t);var e=i(),n=function(){var t=new u;return setTimeout(function(){var e=document.querySelector("* /deep/ .coccoc-scroll");e&&e.scrollHeight>e.clientHeight?t.resolve(l.POPUP_OPENED_SCROLLSIZE):t.resolve(l.POPUP_OPENED_DEFAULTSIZE)},500),t}();e.success(function(t){s("en"===t?l.POPUP_OPENED_ENPAGE:l.POPUP_OPENED_NOTENPAGE)}),n.success(function(t){s(t)})}function i(){var t=new u;return chrome.runtime.sendMessage({type:"get_language"},function(e){e&&e.lang?t.resolve(e.lang.substring(0,2).toLowerCase()):t.resolve("un")}),t}function s(t){chrome.runtime.sendMessage({type:"report_small_count",name:"PopupOpened",value:t})}function r(){if(!document.head&&!document.body)return setTimeout(r);document.querySelector('link[rel="stylesheet"], style')||(document.head||document.body).appendChild(document.createElement("style"))}options=new _,options.load();var c=null,a=null,l={POPUP_OPENED_SELECTION:10,POPUP_OPENED_DOUBLECLICK:11,POPUP_OPENED_CONTEXTMENU:12,POPUP_OPENED_NOTENPAGE:13,POPUP_OPENED_ENPAGE:14,POPUP_OPENED_DEFAULTSIZE:15,POPUP_OPENED_SCROLLSIZE:16},h=["calendar.google.com","docs.google.com","paper.dropbox.com"];selection.onSelect.addListener(function(n){var o=window.location.hostname;if(options.isDictionaryEnabled()&&-1===h.indexOf(o)){if(n.text=n.text.trim(),!n.text.length)return!1;var s=t(n.text),r=n.element.localName;if(n&&2!==n.detail&&s&&options.isShowTooltipEnabled()&&options.isTranslateEnabled(r))return e(n.text)&&(n.copy=!0),n.conversionText=s,n.dblclickConversion=!1,void i().success(function(t){n.siteLang=t,unitConversion.show(n)});a={text:n.text,coords:n.coords,style:n.style};var l=!n.coords||!options.isDictionaryEnabled(),d={text:n.text,notify:l},p=new u;chrome.runtime.sendMessage({type:"on_selection",data:d},function(t){p[t&&!t.error?"resolve":"reject"](t)}),p.success(function(t){("input"!==r||options.isTranslateEnabled("input"))&&(n.detail&&1===n.detail&&!options.isShowTooltipEnabled()||n.detail&&2===n.detail&&!options.isDoubleClickTranslateEnabled()||popup.show({data:t.translation,lang:t.langSrc,coords:n.coords,style:n.style,expand:!1}))}),c={text:n.text,request:p,source:r}}}),selection.onDeselect.addListener(function(t){t&&chrome.runtime.sendMessage({type:"disable_menu"}),null!==c&&(c.request.reject(),c=null),t||window.popup.hide()}),popup.onPopupShow.addListener(o.bind(this,l.POPUP_OPENED_SELECTION)),document.addEventListener("dblclick",setTimeout.bind(this,function(){if(c){if(!options.isDoubleClickTranslateEnabled(c.source)||"input"===c.source)return;c.request.success(function(){o(l.POPUP_OPENED_DOUBLECLICK),popup.expanded=!0})}}),!1),window.addEventListener("resize",n,!1),document.addEventListener("contextmenu",n,!1),chrome.runtime.onMessage.addListener(function(t,e,n){switch(t.type){case"on_context_menu":if(!t.data)return;var i=t.data.translation;if(!i)return;var s=null,r=null;if(a&&a.text===t.data.originalText?(s=a.coords,r=a.style):(a=null,s=selection.getCoords(),r=selection.getStyle()),null===s)return;o(l.POPUP_OPENED_CONTEXTMENU),popup.show({data:i,lang:t.data.langSrc,coords:s,style:r,expand:!0});break;case"close_popup":popup.hide()}}),r()}var l;!function(t){"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define?define(t):l=t}(function(){function t(t,e){return RegExp.prototype.test.call(t,e)}function e(e){return!t(_,e)}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t){this.string=t,this.tail=t,this.pos=0}function i(t,e){this.view=t,this.parent=e,this.clearCache()}function s(){this.clearCache()}function r(t){for(var e,n=t[3],o=n;(e=t[4])&&e.length;)o=(t=e[e.length-1])[3];return[n,o]}function c(t){function e(t,e,o){if(!n[t]){var i=c(e);n[t]=function(t,e){return i(t,e,o)}}return n[t]}var n={};return function(n,o,i){for(var s,c,a="",l=0,d=t.length;l<d;++l)switch((s=t[l])[0]){case"#":c=i.slice.apply(i,r(s)),a+=n._section(s[1],o,c,e(l,s[4],i));break;case"^":a+=n._inverted(s[1],o,e(l,s[4],i));break;case">":a+=n._partial(s[1],o);break;case"&":a+=n._name(s[1],o);break;case"name":a+=n._escaped(s[1],o);break;case"text":a+=s[1]}return a}}function a(t){for(var e,n,o=[],i=o,s=[],r=0;r<t.length;++r)switch((e=t[r])[0]){case"#":case"^":e[4]=[],s.push(e),i.push(e),i=e[4];break;case"/":if(0===s.length)throw new Error("Unopened section: "+e[1]);if((n=s.pop())[1]!==e[1])throw new Error("Unclosed section: "+n[1]);i=s.length>0?s[s.length-1][4]:o;break;default:i.push(e)}if(n=s.pop())throw new Error("Unclosed section: "+n[1]);return o}function l(t){for(var e,n,o=0;o<t.length;++o)e=t[o],n&&"text"===n[0]&&"text"===e[0]?(n[1]+=e[1],n[3]=e[3],t.splice(o--,1)):n=e}function d(t){if(2!==t.length)throw new Error("Invalid tags: "+t.join(" "));return[new RegExp(n(t[0])+"\\s*"),new RegExp("\\s*"+n(t[1]))]}var u={};u.name="mustache.js",u.version="0.7.0",u.tags=["{{","}}"],u.Scanner=o,u.Context=i,u.Writer=s;var h=/\s*/,p=/\s+/,_=/\S/,f=/\s*=/,g=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/,v=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};u.escape=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return E[t]})},o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},o.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},i.make=function(t){return t instanceof i?t:new i(t)},i.prototype.clearCache=function(){this._cache={}},i.prototype.push=function(t){return new i(t,this)},i.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."===t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){var o=t.split("."),i=0;for(e=n.view;e&&i<o.length;)e=e[o[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(t,e){return this._compile(this._cache,t,t,e)},s.prototype.compilePartial=function(t,e,n){return this._compile(this._partialCache,t,e,n)},s.prototype.render=function(t,e,n){return this.compile(t)(e,n)},s.prototype._compile=function(t,e,n,o){if(!t[e]){var s=c(u.parse(n,o)),r=this;t[e]=function(t,e){if(e)if("function"==typeof e)r._loadPartial=e;else for(var o in e)r.compilePartial(o,e[o]);return s(r,i.make(t),n)}}return t[e]},s.prototype._section=function(t,e,n,o){var i=e.lookup(t);switch(typeof i){case"object":if(v(i)){for(var s="",r=0,c=i.length;r<c;++r)s+=o(this,e.push(i[r]));return s}return i?o(this,e.push(i)):"";case"function":var a=this;return i.call(e.view,n,function(t){return a.render(t,e)})||"";default:if(i)return o(this,e)}return""},s.prototype._inverted=function(t,e,n){var o=e.lookup(t);return!o||v(o)&&0===o.length?n(this,e):""},s.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));var n=this._partialCache[t];return n?n(e):""},s.prototype._name=function(t,e){var n=e.lookup(t);return"function"==typeof n&&(n=n.call(e.view)),null==n?"":String(n)},s.prototype._escaped=function(t,e){return u.escape(this._name(t,e))},u.parse=function(t,i){for(var s,r,c,_,v=d(i=i||u.tags),E=new o(t),C=[],w=[],N=!1,y=!1;!E.eos();){if(s=E.pos,c=E.scanUntil(v[0]))for(var b=0,S=c.length;b<S;++b)e(_=c.charAt(b))?w.push(C.length):y=!0,C.push(["text",_,s,s+1]),s+=1,"\n"===_&&function(){if(N&&!y)for(;w.length;)C.splice(w.pop(),1);else w=[];N=!1,y=!1}();if(s=E.pos,!E.scan(v[0]))break;if(N=!0,r=E.scan(m)||"name",E.scan(h),"="===r)c=E.scanUntil(f),E.scan(f),E.scanUntil(v[1]);else if("{"===r){var O=new RegExp("\\s*"+n("}"+i[1]));c=E.scanUntil(O),E.scan(g),E.scanUntil(v[1]),r="&"}else c=E.scanUntil(v[1]);if(!E.scan(v[1]))throw new Error("Unclosed tag at "+E.pos);C.push([r,c,s,E.pos]),"name"!==r&&"{"!==r&&"&"!==r||(y=!0),"="===r&&(v=d(i=c.split(p)))}return l(C),a(C)};var C=new s;return u.clearCache=function(){return C.clearCache()},u.compile=function(t,e){return C.compile(t,e)},u.compilePartial=function(t,e,n){return C.compilePartial(t,e,n)},u.render=function(t,e,n){return C.render(t,e,n)},u.to_html=function(t,e,n,o){var i=u.render(t,e,n);if("function"!=typeof o)return i;o(i)},u}()),window.Mustache=l;var d={};d.query=function(t,e){return(e=e||document).querySelector(t)},d.queryAll=function(t,e){return(e=e||document).querySelectorAll(t)},Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),d.getNearest=function(t,n){return e.call(t,n)},d.getElement=function(t){for(;t&&1!==t.nodeType;)t=t.parentNode;return t},d.checkDarkPage=function(){var t=window.getComputedStyle(document.body).backgroundColor;if(!t)return!1;var e=/rgba?\((\d+)\,\s(\d+)\,\s(\d+)(\,\s(\d+))?\)/g.exec(t);return(!e[4]||0!=+e[5])&&((e=[+e[1],+e[2],+e[3]]).forEach(function(t,n){var t=t/255;e[n]=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),!(.2126*e[0]+.7152*e[1]+.0722*e[2]>.179))},d.thouShallNotPass=function(t){return t.preventDefault(),t.stopPropagation(),!1},d.noop=function(){},"undefined"==typeof PRODUCTION&&(d.throttle=function(t,e){var n,o=null;return function(){o?n=arguments:(n=arguments,o=setTimeout(function(){return o=null,t.apply(this,n)},e))}},d.html=function(t){var e=document.createElement(t.tag||"keke");if(t.style)for(var n in t.style)e.style[n]=t.style[n];return t.text&&(e.textContent=t.text),e},d.attachShadow=function(t){return t.attachShadow?t.attachShadow({mode:"open"}):t.createShadowRoot()}),window.Utils=d;var u=function(t){if(0===arguments.length)return this._init(),this;if(t instanceof u)return t;var e=new u;return e.resolve(t),e};u.RUNNING=0,u.RESOLVED=1,u.FAILED=2,u.prototype={constructor:u,_init:function(){this._results=[],this._subscribers=[],this.state=u.RUNNING},_notify:function(){var t=this;this._subscribers.forEach(function(e){e.apply(t,t._results)}),this._subscribers=[]},resolve:function(){return this.state=u.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=u.FAILED,this._results=arguments,this._notify(),this},subscribe:function(t){this.state!==u.RUNNING?t.apply(this,this._results):this._subscribers.push(t)},done:function(t){return this.subscribe(t),this},success:function(t){var e=this;return this.subscribe(function(){e.state===u.RESOLVED&&t.apply(e,e._results)}),this},fail:function(t){var e=this;return this.subscribe(function(){e.state===u.FAILED&&t.apply(e,e._results)}),this},bind:function(t){return(t=new u(t)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},u.when=function(){var t=[];return t=Array.isArray(arguments[0])?arguments[0]:d.toArray(arguments),new u.When(t)},u.When=function(t){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=u.RUNNING,this._thingsToDo=t.length,this._results=Array(this._thingsToDo),this._init(t)},u.When.prototype={constructor:u.When,_init:function(t){var e=this;t.forEach(function(t,n){(t=new u(t)).subscribe(function(){t.state===u.FAILED&&(e._state=u.FAILED),e._results[n]=d.toArray(arguments),e._thingsToDo--,e._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var t=[];this._results.forEach(function(e){t=t.concat(e)}),this._state===u.FAILED?this._runCallbacks(this._failCallbacks,t):this._runCallbacks(this._successCallbacks,t),this._runCallbacks(this._doneCallbacks,t),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(t,e){t.forEach(function(t){t.apply(this,e)})},done:function(t){return this._doneCallbacks.push(t),this._checkIsDone(),this},success:function(t){return this._successCallbacks.push(t),this._checkIsDone(),this},fail:function(t){return this._failCallbacks.push(t),this._checkIsDone(),this}},u.chain=function(){function t(e){if(!e.length)return n.resolve.apply(n,o);var i=e.shift();"function"==typeof i?u(i()).done(function(n){o.push(n),t(e)}):(o.push(i),t(e))}var e,n=new u,o=[];return e=Array.isArray(arguments[0])?arguments[0]:d.toArray(arguments),t(e),n},window.Promise=u,Notifier=function(){this._subscribers=[]},Notifier.prototype={constructor:Notifier,addListener:function(t){return"function"==typeof t&&this._subscribers.push(t),this},unsubscribe:function(t){var e=this._subscribers.indexOf(t);return-1!==e&&this._subscribers.splice(e,1),this},trigger:function(){var t=arguments,e=this;return this._subscribers.forEach(function(n){n.apply(e,t)}),this}};window;var h=["text","tel","url"],p=function(){this._lastSelectionText=this.getText(),this.onSelect=new Notifier,this.onDeselect=new Notifier;var t=this._checkSelection.bind(this);document.addEventListener("mouseup",t,!1),document.addEventListener("keyup",t,!1),document.addEventListener("contextmenu",t,!1),document.addEventListener("select",t,!1),this.listActivedFrameDocuments=[],this.listFuncListeners=[],window.addEventListener("load",function(){for(var e=document.querySelectorAll("iframe"),n=0;n<e.length;n++)if(e[n].contentDocument){var i=o(t,e[n]);this.listActivedFrameDocuments.push(e[n].contentDocument),this.listFuncListeners.push(i),e[n].contentDocument.addEventListener("mouseup",i,!1),e[n].contentDocument.addEventListener("keyup",i,!1),e[n].contentDocument.addEventListener("contextmenu",i,!1),e[n].contentDocument.addEventListener("select",i,!1)}}.bind(this),!1),window.addEventListener("beforeunload",function(){for(var t=0;t<this.listActivedFrameDocuments.length;t++)this.listActivedFrameDocuments[t].removeEventListener("mouseup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("keyup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("contextmenu",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("select",this.listFuncListeners[t],!1);this.listActivedFrameDocuments=[],this.listFuncListeners=[]}.bind(this),!1)};p.prototype={constructor:p,_checkSelection:function(t,e){if(d.getNearest(t.target,".corom-element")&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),d.getNearest(t.target,".corom-element")||"keyup"===t.type&&"input"!==t.target.tagName.toLowerCase()&&"textarea"!==t.target.tagName.toLowerCase()&&!t.target.isContentEditable)return this.onDeselect.trigger(!0),!0;"mouseup"===t.type&&(this._lastMouseupEvent=t),this.contextElement=e;var o=this.getContextWindow().getSelection(),i=n(o),a=d.getElement(o.focusNode);if(i&&this._lastSelectionText===i&&(o.containsNode(t.target,!0)||c(t.target,a)||c(a,t.target)))return"contextmenu"!==t.type&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),this.onDeselect.trigger(!0),!0;if(i&&"contextmenu"===t.type)this._lastSelectionText=this._lastContextMenu||this._lastSelectionText;else if(this.onDeselect.trigger(),i){var l=this.getSelectionCoords(o),u="select"===t.type?t.target:a;if(!l&&"select"===t.type){var h=t.target,p="text";h&&("TEXTAREA"===h.tagName||r(h))&&h.selectionStart!=h.selectionEnd&&(l=this.getTextBoundingRect(h,h.selectionStart,h.selectionEnd),p="input",u=h),t.detail=this._lastMouseupEvent.detail}if("input"!==p&&(p=s(u)?"input":"notInput"),l){this._lastSelectionText=i;var _=this.getSelectionStyle(d.getElement(u)),f=this.getContextWindow().getComputedStyle(d.getElement(u)).getPropertyValue("zoom");f=f?parseInt(f):1,l.right+=this.getContextPositionLeft(),l.left+=this.getContextPositionLeft(),l.top+=this.getContextPositionTop(),l.bottom+=this.getContextPositionTop(),l.left*=f,l.right*=f,l.top*=f,l.bottom*=f,l.height*=f,l.width*=f,this.onSelect.trigger({element:t.target,text:i,coords:l,style:_,source:p,detail:t.detail})}}else this._lastSelectionText=null},getContextWindow:function(){return this.contextElement?this.contextElement.contentWindow:window},getContextDocument:function(){return this.contextElement?this.contextElement.contentDocument:document},getContextPositionTop:function(){return this.contextElement?this.contextElement.getBoundingClientRect().top:0},getContextPositionLeft:function(){return this.contextElement?this.contextElement.getBoundingClientRect().left:0},getCoords:function(){return this.getSelectionCoords(this.getContextWindow().getSelection())},getStyle:function(){return this.getSelectionStyle(this.getContextWindow().getSelection())},getText:function(){return n(this.getContextWindow().getSelection())},getBoundTop:function(t){var e=t.getBoundingClientRect(),n=this.getContextWindow().getComputedStyle(t);return e.top+t.clientTop+parseInt(n["padding-top"])||0},getSelectionStyle:function(t){var e=d.getElement(t);if(!e)return{background:"highlight"};var n=this.getContextWindow().getComputedStyle(e).backgroundColor,o=this.getContextWindow().getComputedStyle(e,"::selection"),i=parseInt(o.lineHeight),s=i,r=o.backgroundColor,c=o.color,a=this.getContextWindow().navigator.userAgent.match(/Windows/i);return"rgba(0, 0, 0, 0)"!==r&&r!==n||(r=a?"#328efe":"highlight"),isNaN(s)&&(s=1.14*parseInt(o.fontSize)),{lineHeight:i,assumedLineHeight:s,background:r,color:c}},getElementOffset:function(t){var e=this.getContextDocument().body,n=this.getContextDocument().documentElement,o=this.getContextDocument().createElement("div");o.style.paddingLeft=o.style.width="1px",e.appendChild(o);var i=2==o.offsetWidth;e.removeChild(o),o=t.getBoundingClientRect();var s=n.clientTop||e.clientTop||0,r=n.clientLeft||e.clientLeft||0,c=this.getContextWindow().pageYOffset||i&&n.scrollTop||e.scrollTop,a=this.getContextWindow().pageXOffset||i&&n.scrollLeft||e.scrollLeft;return{top:o.top+c-s,left:o.left+a-r}},getTextBoundingRect:function(t,e,n,o){if(!(t&&"value"in t))return null;if(e>=n)return null;var s=this.getContextWindow().getComputedStyle(t),r=this.getElementOffset(t),c=r.top,a=r.left,l=parseFloat(s.width),d=parseFloat(s.height);c+=parseFloat(s["padding-top"]),c+=parseFloat(s["border-top-width"]),a+=parseFloat(s["padding-left"]),a+=parseFloat(s["border-left-width"]),a+=1;var u=i(s),h=t.value,p=h.length,_=this.getContextDocument().createElement("div");e>0&&this.appendSpanElement(_,u,h.substring(0,e));var f=this.appendSpanElement(_,u,h.substring(e,n));p>n&&this.appendSpanElement(_,u,h.substring(n,p)),_.style.cssText=u,_.style.position="absolute",_.style.top=c+"px",_.style.left=a+"px",_.style.width=l+"px",_.style.height=d+"px",this.getContextDocument().body.appendChild(_);var g=f.getBoundingClientRect();return g={bottom:g.bottom,top:g.top,height:g.height,left:g.left,right:g.right,width:g.width},g.left-=t.scrollLeft,g.right-=t.scrollLeft,g.bottom-=t.scrollTop,g.top-=t.scrollTop,o||_.parentNode.removeChild(_),g},appendSpanElement:function(t,e,n){var o=this.getContextDocument().createElement("span");return o.style.cssText=e,o.textContent=n,t.appendChild(o),o},getSelectionCoords:function(t){if(t.rangeCount){var e=t.getRangeAt(t.rangeCount-1),n=this.getSelectionStyle(t);return this.getCorrectedRangeRect(e,n)}return null},getCorrectedRangeRect:function(t,e){var n,o=t.getBoundingClientRect();if(o.width&&o.height){var i=e.lineHeight,s=t.endContainer.parentElement,r=this.getBoundTop(d.getElement(s));return n=o.bottom-r<1.5*e.assumedLineHeight?r:i?o.bottom-i:o.top,{left:o.left,right:o.right,top:n,bottom:o.bottom,height:o.bottom-n,width:o.width}}}},"undefined"==typeof PRODUCTION&&(p.prototype.__drawRect=function(t,e){var n="rgb("+[192*Math.random()|0,192*Math.random()|0,192*Math.random()|0].join(",")+")";node=d.html({style:{boxSizing:"border-box",border:"1px dotted "+n,zIndex:2147483647,position:"absolute",left:t.left+"px",top:this.getContextDocument().body.scrollTop+t.top+"px",height:t.bottom-t.top+"px",width:t.width+"px",fontWeight:"bold",overflow:"hidden",opacity:.6,color:n},text:""+e}),this.getContextDocument().body.appendChild(node)},p.prototype.__drawElementBounds=function(t,e){var n=(t=d.getElement(t)).getBoundingClientRect();this.__drawRect(n,e)},p.prototype.__drawSeletionBounds=function(){var t=this.getContextWindow().getSelection();if(t.rangeCount){for(var e=this.getSelectionStyle(selection),n=0;n<t.rangeCount;++n){for(var o=(s=t.getRangeAt(n)).getClientRects(),i=0;i<o.length;++i)this.__drawRect(o[i],"r"+n+","+i),this.__drawRect(this.getCorrectedRangeRect(o[i],e),"r"+n+","+i+"c");this.__drawRect(s.getBoundingClientRect(),"b"+n+","),this.__drawElementBounds(s.commonAncestorContainer,"r"+n+"A")}var s=t.getRangeAt(t.rangeCount-1);return this.getCorrectedRangeRect(s,e)}}),window.selection=new p;var _=function(){this._storage=chrome.storage.local,this._options={},this._default={dictionary_enabled:!0,double_click_translate_enabled:!0,show_tooltip_enabled:!0,input_translate_enabled:!1,conversion_notification_disabled:!1,conversion_notification_last:0,conversion_notification_type:1};var t=this;chrome.storage.onChanged.addListener(function(e,n){if("local"===n)for(var o in e)t._options[o]=e[o].newValue}),this.isDictionaryEnabled=function(){return t.get("dictionary_enabled")},this.isTranslateEnabled=function(e){return!!t.isDictionaryEnabled()&&("input"!==e||t.get("input_translate_enabled"))},this.isDoubleClickTranslateEnabled=function(e){return!!t.isTranslateEnabled(e)&&t.get("double_click_translate_enabled")},this.isShowTooltipEnabled=function(){return!!t.isDictionaryEnabled()&&t.get("show_tooltip_enabled")}};_.prototype={load:function(){var t=new u,e=this;return this._storage.get(null,function(n){e._options=n,t.resolve(n)}),t},set:function(t,e){var n={};"string"!=typeof t&&"number"!=typeof t||void 0===e||(n[t]=e,this._options[t]=e,this._storage.set(n))},get:function(t){return t in this._options?this._options[t]:this._default[t]}},window.Options=_,function(){function t(t){chrome.runtime.sendMessage({type:"report_small_count",name:"PopupAction",value:t})}var e=function(){this._coords={top:0,left:0,bottom:0,right:0,width:0,height:0},this._isShown=!1,this._isExpanded=!1,this._createNodes(),this.onPopupShow=new Notifier};e.prototype={constructor:e,TRIGGER_INNER_HTML:'<div class="coccoc-tt-icon"></div>                          <div class="coccoc-tt-text">Dịch</div>',POPUP_INNER_HTML:"{{text}}",HORIZONTAL_GAP:window===window.top?20:0,VERTICAL_GAP:window===window.top?20:0,_createNodes:function(){var t=document.createElement("div");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.right=0,t.style.height=0,t.style.margin=0,t.style.textAlign="left",t.style.zIndex=1e10,t.style.pointerEvents="none",t.style.border="none",t.style.all="initial",t.hidden=!0,t.classList.add("corom-element"),this._rootNode=t;var e=document.createElement("style");e.innerHTML='@import "'+chrome.extension.getURL("css/style.css")+'";',this._shadowRoot=d.attachShadow(t),this._shadowRoot.appendChild(e),this._createTriggerNode(),this._createPopupNode(),this._isExpanded=!1,window.addEventListener("pagehide",this._destroy.bind(this)),this._setPopupListener()},_createTriggerNode:function(){var t=document.createElement("div");t.classList.add("corom-trigger"),t.innerHTML=this.TRIGGER_INNER_HTML,t.hidden=!0,t.addEventListener("mouseup",function(t){this.expanded=!0,this.onPopupShow.trigger()}.bind(this),!1),this._triggerNode=t},_createPopupNode:function(){var t=document.createElement("div"),e=document.createElement("div");e.classList.add("corom-popup"),t.appendChild(e),t.style.left=0,t.style.right=0,t.style.pointerEvents="none",t.style.position="absolute",t.style.zIndex="10000000000000",t.hidden=!0,this._popupNode=t,this._popupNodeInner=e},_setText:function(t,e){this._currentTranslation={word:t.word,lang:e},t.incIndex=function(){++window.INDEX||(window.INDEX=1)},t.getIndex=function(){return window.INDEX},t.resetIndex=function(){"zh-CN"!==e&&(window.INDEX=0)},t.initIndex=function(){window.INDEX=0},t.existWriting=function(){return Boolean(t.writing)};var n=options.get("popup_template");this._popupNodeInner.innerHTML=l.render(n,t)},_setPopupListener:function(){this._popupNode.addEventListener("click",function(e){switch(e.target.id){case"btn_speaker":t(n.POPUP_ACTION_SPEAKER),chrome.runtime.sendMessage({type:"speak",word:this._currentTranslation.word,lang:this._currentTranslation.lang},function(t){"end"===t&&this._stopSpeaking()}.bind(this)),e.target.classList.add("btn-disabled");break;case"btn_more":window.open("https://www.coccoc.com/search#query="+this._currentTranslation.word,"_blank"),t(n.POPUP_ACTION_OPENLINK);break;case"btn_close":this.hide(!0);break;case"coccoc-synonym":t(n.POPUP_ACTION_SYNONYM)}}.bind(this))},_setScrollListener:function(){this._popupNodeInner.querySelector(".coccoc-scroll").addEventListener("scroll",function(){this._scrolled||(this._scrolled=!0,t(n.POPUP_ACTION_SCROLL))}.bind(this))},_stopSpeaking:function(){chrome.runtime.sendMessage({type:"stop_speaking"});var t=this._popupNode.querySelector("#btn_speaker");t&&t.classList.remove("btn-disabled")},_setStyle:function(t){var e=d.checkDarkPage();this._triggerNode.style.backgroundColor=e?"#fff":"#424242",this._triggerNode.style.setProperty("--triangleColor",this._triggerNode.style.backgroundColor),this._triggerNode.style.color=e?"#424242":"#fff"},_getActualPopupSize:function(){this._isShown||(this._popupNodeInner.style.left="-1000px",this._triggerNode.style.left="-1000px",this._popupNode.hidden=!1,this._shadowRoot.appendChild(this._popupNode));var t={width:this._popupNodeInner.offsetWidth?this._popupNodeInner.offsetWidth:300,height:this._popupNodeInner.offsetHeight?this._popupNodeInner.offsetHeight:250};return this._isShown||(this._popupNode.hidden=!this._isExpanded,this.hide()),t},_destroy:function(){null!==this._triggerNode&&(this._stopSpeaking(),this._triggerNode.remove(),this._popupNode.remove(),this._rootNode.remove(),this._shadowRoot=null,this._triggerNode=null,this._popupNode=null,this._popupNodeInner=null,this._rootNode=null)},get isShown(){return this._isShown},get coords(){return this._coords},set coords(t){var e=document.scrollingElement.scrollTop||window.pageYOffset,n=window.innerHeight,o=window.innerWidth,i=this._getActualPopupSize();t.top+i.height+this.VERTICAL_GAP>n?this._popupNode.style.top=t.top+e-i.height+"px":this._popupNode.style.top=t.top+t.height+e+"px",t.top-45>=0?(this._triggerNode.style.top=t.top+e-44-1+"px",this._triggerNode.classList.remove("coccoc-triangle-top"),this._triggerNode.classList.add("coccoc-triangle-bottom")):(this._triggerNode.style.top=t.top+e+t.height+8+1+"px",this._triggerNode.classList.remove("coccoc-triangle-bottom"),this._triggerNode.classList.add("coccoc-triangle-top")),this._triggerNode.style.setProperty("--triangleLeft","50%"),this._triggerNode.style.left=t.right-t.width/2-44+"px";var s=Math.max(t.left+i.width+this.HORIZONTAL_GAP-o,0);this._popupNodeInner.style.left=Math.max(t.left-s,this.HORIZONTAL_GAP)+"px",this._coords=t},get expanded(){return this._isExpanded},set expanded(t){this._isExpanded=t,setTimeout(function(){this._triggerNode.hidden=t,this._popupNode.hidden=!t,this._rootNode.hidden=!1}.bind(this),0)},show:function(t){this._setText(t.data,t.lang),this.coords=t.coords,this._setStyle(t.style),this._injected||(this._shadowRoot.appendChild(this._popupNode),this._shadowRoot.appendChild(this._triggerNode),document.documentElement.appendChild(this._rootNode),this._injected=!0),this.expanded=Boolean(t.expand),this._isShown=!0,this._scrolled=!1,setTimeout(function(){this._setScrollListener()}.bind(this),0)},hide:function(t){(t||this._isShown)&&(this._stopSpeaking(),this._isExpanded=!1,this._triggerNode.hidden=!0,this._popupNode.hidden=!0,this._isShown=!1)}},window.popup=new e,document.addEventListener("mousedown",function(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():window.popup.isShown&&window.popup.hide()},!1),a();var n={POPUP_ACTION_SPEAKER:0,POPUP_ACTION_OPENLINK:1,POPUP_ACTION_SYNONYM:2,POPUP_ACTION_SCROLL:3}}(),function(){var t=function(){this._init()},e={CONVERSION_ACTION_MORECURRENCY:0,CONVERSION_ACTION_COPYFIRSTCURRENCY:1,CONVERSION_ACTION_COPYSECONDCURRENCY:2,CONVERSION_ACTION_VIEWCOPYTEXT:3,CONVERSION_ACTION_CLICKCOPYTEXT:4,CONVERSION_ACTION_OTHERS:5,CONVERSION_ACTION_BACK:6,CONVERSION_ACTION_EXIT:7,CONVERSION_OPENED_SELECTION:0,CONVERSION_OPENED_DBLCLICK:1};t.prototype={_init:function(){this.TOOLTIP_MAIN=options.get("tooltip_main"),this.TOOLTIP_MORE_CURRENCIES=options.get("tooltip_more_currencies"),this.TOOLTIP_ADD_CURRENCIES=options.get("tooltip_add_currencies"),this._moneySymbolMap={$:"USD","€":"EUR","￥":"JPY","¥":"CNY","₫":"VND"},this._setupMain(),this._setupMoreCurrencies(),this._setupAddCurrencies(),window.addEventListener("pagehide",this._destroy.bind(this))},_setupMain:function(){var t=document.createElement("div");t.className="coccoc-money-main hidden",t.addEventListener("click",function(t){var n=t.target;switch(n.className){case"coccoc-btn-currencies":var o=this._tooltipMain.offsetLeft;this._tooltipMoreCurrencies.style.left=o+"px",this._tooltipMain.classList.add("hidden"),this._tooltipMoreCurrencies.classList.remove("hidden"),this._reportConversionAction(e.CONVERSION_ACTION_MORECURRENCY);break;case"coccoc-value":var i=n.innerText;this._copy(i);var s=n.parentNode;"coccoc-value-from"===s.className?this._reportConversionAction(e.CONVERSION_ACTION_COPYFIRSTCURRENCY):"coccoc-value-to"===s.className&&this._reportConversionAction(e.CONVERSION_ACTION_COPYSECONDCURRENCY),s.classList.add("copied"),setTimeout(function(){s.classList.remove("copied")},400);var r=this._tooltipMain.querySelector(".coccoc-btn-copy");r&&r.classList.remove("coccoc-copied");break;case"coccoc-btn-copy":this._reportConversionAction(e.CONVERSION_ACTION_CLICKCOPYTEXT),this._copy(this._selectionData.text),n.classList.add("coccoc-copied"),setTimeout(function(){n.classList.remove("coccoc-copied")},400);break;case"coccoc-btn-close":this._reportConversionAction(e.CONVERSION_ACTION_EXIT),this.hide()}}.bind(this)),t.addEventListener("mouseover",function(e){var n=e.target,o=t.querySelector(".coccoc-conversion");if(o)switch(n.className){case"coccoc-btn-info":o.classList.add("show-info");break;case"coccoc-btn-currencies":case"coccoc-btn-copy":case"coccoc-btn-close":o.classList.remove("show-info")}}),t.addEventListener("mouseleave",function(){var e=t.querySelector(".coccoc-conversion");e&&e.classList.remove("show-info")}),this._tooltipMain=t},_copy:function(t){var e=document.createElement("textarea");e.textContent=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.blur(),document.body.removeChild(e)},_setupMoreCurrencies:function(){var t=document.createElement("div");t.className="coccoc-more-currencies hidden",t.addEventListener("click",function(t){var n=t.target;switch(n.className){case"coccoc-more-back":this._reportConversionAction(e.CONVERSION_ACTION_BACK),this._tooltipMain.classList.remove("hidden"),this._tooltipMoreCurrencies.classList.add("hidden");break;case"coccoc-more-add":this._reportConversionAction(e.CONVERSION_ACTION_OTHERS),this._tooltipMoreCurrencies.classList.add("hidden"),this._tooltipAddCurrencies.classList.remove("hidden");break;case"coccoc-currency-value":case"coccoc-currency-sign":var o=n.parentNode,i=o.innerText;i=i.replace(/\n/g," "),this._copy(i);var s=o.parentNode;s.classList.add("copied"),setTimeout(function(){s.classList.remove("copied")},400)}}.bind(this)),this._tooltipMoreCurrencies=t},_setupAddCurrencies:function(){var t=document.createElement("div");t.className="coccoc-add-currencies hidden",this._tooltipAddCurrencies=t},_setStyle:function(){this._tooltipMain.classList.add("coccoc-dark-theme"),this._tooltipMoreCurrencies.classList.add("coccoc-dark-theme"),this._tooltipAddCurrencies.classList.add("coccoc-dark-theme")},set coords(t){var e,n,o=document.scrollingElement.scrollTop||window.pageYOffset,i=(document.scrollingElement.scrollLeft||window.pageXOffset,window.innerHeight,window.innerWidth);e=t.top-45;var s=this._selectionData.copy?380:260;this._tooltipMain.style.top=(e>=0?e+o:t.top+o+t.height+8+1)+"px",n=Math.max(t.left+t.width/2+s/2+20-i,0);var r=Math.max(t.left+t.width/2-s/2-n,20);this._tooltipMain.style.left=r+"px",e=t.top-130-8-1,this._tooltipMoreCurrencies.style.top=(e>=0?e+o:t.top+o+t.height+8+1)+"px",n=Math.max(t.left+t.width/2+82.5+20-i,0),r=Math.max(t.left+t.width/2-82.5-n,20),this._tooltipMoreCurrencies.style.left=r+"px",e=t.top-45-8-1,this._tooltipAddCurrencies.style.top=(e>=0?e+o:t.top+o+t.height+8+1)+"px",n=Math.max(t.left+t.width/2+143.5+20-i,0),r=Math.max(t.left+t.width/2-143.5-n,20),this._tooltipAddCurrencies.style.left=r+"px"},_format:function(t,e){var n=/\d(?=(\d{3})+(?:\.|$))/g,o=t.toString().split("."),i=o[0].replace(n,"$&,")+"."+(o[1]||"00"),s="";if("VND"===e){for(;t>=1e9;)t/=1e9,s=" tỷ"+s;""!==s&&t>=1e6&&(t/=1e6,s=" triệu"+s),""!==s&&t>=1e3&&(t/=1e3,s=" nghìn"+s),s=t<1e3?t.toFixed(2).substr(0,t>=100?3:4)+s:t.toFixed(0).replace(n,"$&,")}else s=t.toFixed(2).replace(n,"$&,");return{exact:i,semantic:s}},_extractInputData:function(t){var e=/(C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท)[^\S\r\n]?([1-9][0-9]{0,2}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[1-9][0-9]{1,2}(?:\.[0-9]+)+(?:,[0-9]{1,})?|[0-9]+(?:[.,][0-9]{1,})?)|([1-9][0-9]{0,2}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[1-9][0-9]{1,2}(?:\.[0-9]+)+(?:,[0-9]{1,})?|[0-9]+(?:[.,][0-9]{1,})?)[^\S\r\n]?(C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท|GAL|US GAL LQD|GALLON LIQUID US|US GAL|MPH|MILE PER HOUR|MPG|MILE PER GALLON|MILES|MI|YARD|YARDS|YD|INCHES|IN|''|”|"|FEET|FEETS|FT|'|POUND|POUNDS|LB|OUNCE|OUNCES|OZ|TAEL|KWH|KW\/H)?/g,n=/(?:[0-9]{1,3}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[0-9]+(?:\.[0-9]{1,}))(\n|$)/g,o=null,i="",s="units";if(/[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?(?:\s?[X*]\s?[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?){1,2}/g.test(t.conversionText))for(var r=null;r=e.exec(t.conversionText);){var c=r[2]||r[3];(o=o||[]).push(c),i=i||r[1]||r[4]}else(r=e.exec(t.conversionText))&&r.length&&(o=[r[2]||r[3]],i=i||r[1]||r[4]);if(!o||!i)return null;for(var a=["vi","de","fr","id","it","ru"],l=0;l<o.length;l++)n.test(o[l])&&a.indexOf(t.siteLang)<0?o[l]=o[l].replace(/,/g,""):o[l]=o[l].replace(/\./g,"").replace(/,/,"."),n.lastIndex=0;return-1!==["C$","HK$","S$","$","€","￥","¥","円","圓","元","£","₩","원","฿","บาท","USD","EUR","GBP","JPY","CNY","RMB","FR.","SFR.","CHF","CAD","HKD","SGD","KRW","THB"].indexOf(i)&&(s="currency"),{type:s,value:o,sign:i}},_convertData:function(t){var e=new u;return"currency"===t.type?this._convertCurrency(t).success(function(t){e.resolve(t)}):this._convertUnit(t).success(function(t){e.resolve(t)}),e},_convertCurrency:function(t){var e=new u,n=this._standardSymbol(t.sign);return chrome.runtime.sendMessage({type:"get_exchange_rate",money:n},function(o){if(o){var i={type:"currency",inputData:{rawSign:t.sign,abbr:n,text:t.sign+" "+this._format(parseFloat(t.value[0])).exact},outputData:{},currencies:[]},s=this._calculateExchangeReturn(o,t.value[0]);i.outputData.semantic=s.vndValue.semantic+(-1!==s.vndValue.semantic.indexOf("tỷ")?" VNĐ":" ₫"),i.outputData.exact=s.vndValue.exact+" ₫",i.currencies=s.currencies,e.resolve(i)}else e.resolve(null)}.bind(this)),e},_convertUnit:function(t){var e=new u,n=this._standardSymbol(t.sign),o={MILES:[1.60934,"km"],YARDS:[.9144,"m"],FEETS:[.3048,"m"],INCHES:[2.54,"cm"],POUNDS:[.453592,"kg"],OUNCES:[28.3495,"g"],TAEL:[37.7994,"g"],GAL:[3.78541,"l"],MPH:[1.61,"km/h"],MPG:[.42514,"km/l"],"KW/H":[1e3,"W/h"]},i={type:"unit",inputData:{rawSign:t.sign,abbr:n,text:""},outputData:{}};-1!==['"',"”","''","'"].indexOf(t.sign)?i.inputData.text=t.value.join(t.sign+" x ")+t.sign:i.inputData.text=t.value.join(" x ")+" "+t.sign.toLowerCase();var s=[];return t.value.forEach(function(t){s.push(this._format(parseFloat(o[n][0])*parseFloat(t)).semantic)}.bind(this)),i.outputData.semantic=s.join(" x ")+" "+o[n][1],i.outputData.exact=s.join(" x ")+" "+o[n][1],e.resolve(i),e},_standardSymbol:function(t){var e="";switch(t){case"¥":case"￥":e="zh"===this._selectionData.siteLang?"CNY":"JPY";break;case"元":case"CNY":case"RMB":e="CNY";break;case"圓":case"円":case"JPY":e="JPY";break;case"$":case"USD":e="USD";break;case"€":case"EUR":e="EUR";break;case"£":case"GBP":e="GBP";break;case"FR.":case"SFR.":case"CHF":e="CHF";break;case"C$":case"CAD":e="CAD";break;case"HK$":case"HKD":e="HKD";break;case"S$":case"SGD":e="SGD";break;case"₩":case"원":case"KRW":e="KRW";break;case"฿":case"บาท":case"THB":e="THB";break;case"''":case"”":case'"':case"IN":case"INCHE":case"INCHES":e="INCHES";break;case"'":case"FT":case"FTS":case"FEET":case"FEETS":e="FEETS";break;case"LB":case"LBS":case"POUND":case"POUNDS":e="POUNDS";break;case"MI":case"MILES":e="MILES";break;case"YD":case"YARD":e="YARDS";break;case"OZ":case"OUNCE":case"OUNCES":e="OUNCES";break;case"KWH":case"KW/H":e="KW/H";break;case"MPH":case"MILE PER HOUR":e="MPH";break;case"GAL":case"GALLON":case"GALLONS":case"US GAL":case"GALLON LIQUID US":case"US GAL LQD":e="GAL";break;case"MPG":case"MILE PER GALLON":e="MPG";break;default:e=t}return e},_calculateExchangeReturn:function(t,e){var n={vndValue:{},currencies:[]};return Object.keys(this._moneySymbolMap).forEach(function(o){"₫"!==o?n.currencies.push({short:this._moneySymbolMap[o],value:this._format(parseFloat(t[this._moneySymbolMap[o]]||1)*parseFloat(e),this._moneySymbolMap[o]).semantic,sign:this._moneySymbolMap[o]===e.currency?e.symbol:o}):n.vndValue=this._format(parseFloat(t.VND)*parseFloat(e),"VND")}.bind(this)),n},show:function(t){this._selectionData=t;var n=this._extractInputData(t);n&&(this._convertData(n).success(function(n){var o={isCurrencyConvert:"currency"===n.type,value_from:n.inputData.text,value_to:n.outputData,btn_copy:t.copy,currencies:n.currencies,rate_source:"CNY"===n.inputData.abbr?"www.bidv.com.vn":"www.vietcombank.com.vn"};this._tooltipMain.innerHTML=l.render(this.TOOLTIP_MAIN,o),this._tooltipMoreCurrencies.innerHTML=l.render(this.TOOLTIP_MORE_CURRENCIES,o),this._tooltipAddCurrencies.innerHTML=l.render(this.TOOLTIP_ADD_CURRENCIES,o),this._setStyle(),this.coords=t.coords,this._tooltipMain.classList.remove("hidden"),this.isShown=!0,popup._rootNode.hidden=!1,this._reportConversionOpened(t.dblclickConversion?e.CONVERSION_OPENED_DBLCLICK:e.CONVERSION_OPENED_SELECTION),t.copy&&this._reportConversionAction(e.CONVERSION_ACTION_VIEWCOPYTEXT),this._reportConversionData(Date.now(),n.type),this._reportNotification()}.bind(this)),this._injected||(popup._shadowRoot.appendChild(this._tooltipMain),popup._shadowRoot.appendChild(this._tooltipMoreCurrencies),popup._shadowRoot.appendChild(this._tooltipAddCurrencies),document.documentElement.appendChild(popup._rootNode,document.body),this._injected=!0))},hide:function(t){this.isShown&&(this._tooltipMain.classList.add("hidden"),this._tooltipMoreCurrencies.classList.add("hidden"),this._tooltipAddCurrencies.classList.add("hidden"),this.isShown=!1,t&&this._reportConversionAction(e.CONVERSION_ACTION_EXIT))},_destroy:function(){this._tooltipMain&&(this._tooltipMain.remove(),this._tooltipMain=null),this._tooltipMoreCurrencies&&(this._tooltipMoreCurrencies.remove(),this._tooltipMoreCurrencies=null),this._tooltipAddCurrencies&&(this._tooltipAddCurrencies.remove(),this._tooltipAddCurrencies=null)},_reportConversionAction:function(t){chrome.runtime.sendMessage({type:"report_small_count",name:"ConversionAction",value:t})},_reportConversionOpened:function(t){chrome.runtime.sendMessage({type:"report_small_count",name:"ConversionOpened",value:t})},_reportConversionData:function(t,e){var n={timestamp_ms:t,page_url:window.location.href,type:"converter:"+e};chrome.runtime.sendMessage({type:"report_custom_data",value:n})},_reportNotification:function(){var t=options.get("conversion_notification_last"),e=options.get("conversion_notification_user"),n=Date.now();if(e&&t&&!(t&&n-t>864e5)){var o={user_group:e};chrome.runtime.sendMessage({type:"report_conversion_shown",data:o})}}},document.addEventListener("mousedown",function(t){!d.getNearest(t.target,".corom-element")&&window.unitConversion&&window.unitConversion.isShown&&window.unitConversion.hide(!0)}),window.addEventListener("DOMContentLoaded",function(){window.unitConversion=new t})}(),function(){function t(t){var e=t.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+o,left:e.left+n,width:e.width,height:e.height}}var e=chrome.i18n.getMessage;if(window===window.top){var n={USER_IGNORED:"user_ignored",ALREADY_USE:"already_use",TRY_NOW:"try_now"},o=null,i={amazon:{url_regex:/www\.amazon\.com/,price_selector:"#priceblock_ourprice, #priceblock_dealprice"},ebay:{url_regex:/ebay\.com/,price_selector:"#prcIsum"},alibaba:{url_regex:/www\.alibaba\.com/,price_selector:".ma-ref-price, .ma-spec-price"},aliexpress:{url_regex:/aliexpress\.com/,price_selector:"div > #j-sku-discount-price, div > #j-sku-price"},zara:{url_regex:/zara\.com(?!(?:\/vn))/,price_selector:".price._product-price"},hm:{url_regex:/hm\.com/,price_selector:".price-value"},uniqlo:{url_regex:/uniqlo\.com/,price_selector:"#price, .price-sales.pdp-space-price"},rakuten:{url_regex:/rakuten\.co\.jp/,price_selector:".price2"},banggood:{url_regex:/banggood\.com/,price_selector:".item_now_price, .item_old_price"},gearbest:{url_regex:/gearbest\.com/,price_selector:".goodsIntro_promoPrice > .goodsIntro_priceWrap > .goodsIntro_price, .goodsIntro_priceWrap > .goodsIntro_price"},1688:{url_regex:/detail\.1688\.com\/offer\/\d+\.html/,price_selector:"span.price-now, .price-original-sku > span.value, .price span.value"},dmm:{url_regex:/dmm\.com/,price_selector:".now-result, .price"},taobao:{url_regex:/taobao\.com/,price_selector:"#J_StrPrice"},tmall:{url_regex:/tmall\.com/,price_selector:".tm-price"}},s=function(){this._isShown=!1};s.prototype={constructor:s,_init:function(){this._tooltipNode=this._createNotiTooltipNode(),this._tooltipNode&&(this._waveNode=this._createWaveNode(),window.addEventListener("mousedown",function(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():this._isShown&&(this._reportOnboardingClick("out"),this._destroy(n.USER_IGNORED))}.bind(this),!1),window.popup._shadowRoot.appendChild(this._tooltipNode),this._waveNode&&window.popup._shadowRoot.appendChild(this._waveNode),document.documentElement.appendChild(popup._rootNode,document.body))},_createNotiTooltipNode:function(){var t=options.get("tooltip_notification");if(!t)return null;var o=document.createElement("div");return o.classList.add("conversion-notification"),o.classList.add("hidden"),o.innerHTML=l.render(t,{conversion_noti_header:e("conversion_noti_header"),conversion_noti_message:e("conversion_noti_message"),conversion_btn_already:e("conversion_btn_already"),conversion_btn_try:e("conversion_btn_try")}),o.addEventListener("click",function(t){switch(t.target.id){case"noti_btn_close":this._reportOnboardingClick("close"),this._destroy(n.USER_IGNORED);break;case"noti_btn_already":this._reportOnboardingClick("already"),this._destroy(n.ALREADY_USE);break;case"noti_btn_try":this._reportOnboardingClick("try"),this._destroy(n.TRY_NOW)}}.bind(this)),o},_createWaveNode:function(){var t=options.get("tooltip_wave_focusing");if(!t)return null;var e=document.createElement("div");return e.classList.add("tooltip-wave-wrapper"),e.classList.add("hidden"),e.innerHTML=t,e},_setPosition:function(e){var n=t(e),o=window.innerWidth;this._tooltipNode.style.top=n.top-136-10+"px";var i=n.left+(window.location.hostname.includes("dmm.com")?50:0);i+352+20>o&&(i=o-20-352),this._tooltipNode.style.left=i+"px",this._tooltipNode.classList.remove("hidden"),this._waveNode.style.top=n.top+n.height/2-5+"px";var s=n.left+(window.location.hostname.includes("dmm.com")?70:20);this._waveNode.style.left=s+"px",this._waveNode.classList.remove("hidden"),this._tooltipNode.style.setProperty("--triangleLeft",s-i+5+"px")},show:function(){this._init(),this._posInterval=setInterval(this._relocatePosition.bind(this),1e3)},_relocatePosition:function(){if(options.get("conversion_notification_disabled"))this._destroy();else{var t=d.query(o);if(t&&(t=d.query(o))){this._setPosition(t);var e=d.query(".sufei-dialog");e&&"none"!==e.style.display&&(window.location.hostname.includes("taobao.com")||window.location.hostname.includes("tmall.com"))?(window.popup._rootNode.style.display="none",this._isShown=!1):(window.popup._rootNode.style.display="block",this._isShown=!0)}}},_destroy:function(t){this._isShown&&(this._tooltipNode.classList.add("hidden"),this._waveNode.classList.add("hidden"),this._isShown=!1,this._posInterval&&clearInterval(this._posInterval),options.get("conversion_notification_disabled")||(options.set("conversion_notification_disabled",!0),options.set("conversion_notification_last",Date.now()),options.set("conversion_notification_user",t)))},_reportOnboardingClick:function(t){chrome.runtime.sendMessage({type:"report_onboarding_click",data:{click_type:t}})}},window.conversionNotification=new s;var r=function(t){for(var e=Object.keys(i),n=0;n<e.length;n++)if(t.match(i[e[n]].url_regex))return e[n];return null}(window.location.href);window.addEventListener("DOMContentLoaded",function(){options.get("conversion_notification_disabled")||r&&(o=i[r].price_selector,conversionNotification.show())})}}()}("undefined"==typeof global?global={}:global);