!function(t){function e(t){for(var e=this;e&&(!e.matches||!e.matches(t));)e=e.parentNode;return e}var n={};n.query=function(t,e){return(e=e||document).querySelector(t)},n.queryAll=function(t,e){return(e=e||document).querySelectorAll(t)},Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),n.getNearest=function(t,n){return e.call(t,n)},n.getElement=function(t){for(;t&&1!==t.nodeType;)t=t.parentNode;return t},n.checkDarkPage=function(){var t=window.getComputedStyle(document.body).backgroundColor;if(!t)return!1;var e=/rgba?\((\d+)\,\s(\d+)\,\s(\d+)(\,\s(\d+))?\)/g.exec(t);return(!e[4]||0!=+e[5])&&((e=[+e[1],+e[2],+e[3]]).forEach(function(t,n){var t=t/255;e[n]=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),!(.2126*e[0]+.7152*e[1]+.0722*e[2]>.179))},n.thouShallNotPass=function(t){return t.preventDefault(),t.stopPropagation(),!1},n.noop=function(){},"undefined"==typeof PRODUCTION&&(n.throttle=function(t,e){var n,i=null;return function(){i?n=arguments:(n=arguments,i=setTimeout(function(){return i=null,t.apply(this,n)},e))}},n.html=function(t){var e=document.createElement(t.tag||"keke");if(t.style)for(var n in t.style)e.style[n]=t.style[n];return t.text&&(e.textContent=t.text),e},n.attachShadow=function(t){return t.attachShadow?t.attachShadow({mode:"open"}):t.createShadowRoot()}),window.Utils=n;var i=function(t){if(0===arguments.length)return this._init(),this;if(t instanceof i)return t;var e=new i;return e.resolve(t),e};i.RUNNING=0,i.RESOLVED=1,i.FAILED=2,i.prototype={constructor:i,_init:function(){this._results=[],this._subscribers=[],this.state=i.RUNNING},_notify:function(){var t=this;this._subscribers.forEach(function(e){e.apply(t,t._results)}),this._subscribers=[]},resolve:function(){return this.state=i.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=i.FAILED,this._results=arguments,this._notify(),this},subscribe:function(t){this.state!==i.RUNNING?t.apply(this,this._results):this._subscribers.push(t)},done:function(t){return this.subscribe(t),this},success:function(t){var e=this;return this.subscribe(function(){e.state===i.RESOLVED&&t.apply(e,e._results)}),this},fail:function(t){var e=this;return this.subscribe(function(){e.state===i.FAILED&&t.apply(e,e._results)}),this},bind:function(t){return(t=new i(t)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},i.when=function(){var t=[];return t=Array.isArray(arguments[0])?arguments[0]:n.toArray(arguments),new i.When(t)},i.When=function(t){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=i.RUNNING,this._thingsToDo=t.length,this._results=Array(this._thingsToDo),this._init(t)},i.When.prototype={constructor:i.When,_init:function(t){var e=this;t.forEach(function(t,s){(t=new i(t)).subscribe(function(){t.state===i.FAILED&&(e._state=i.FAILED),e._results[s]=n.toArray(arguments),e._thingsToDo--,e._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var t=[];this._results.forEach(function(e){t=t.concat(e)}),this._state===i.FAILED?this._runCallbacks(this._failCallbacks,t):this._runCallbacks(this._successCallbacks,t),this._runCallbacks(this._doneCallbacks,t),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(t,e){t.forEach(function(t){t.apply(this,e)})},done:function(t){return this._doneCallbacks.push(t),this._checkIsDone(),this},success:function(t){return this._successCallbacks.push(t),this._checkIsDone(),this},fail:function(t){return this._failCallbacks.push(t),this._checkIsDone(),this}},i.chain=function(){function t(e){if(!e.length)return s.resolve.apply(s,o);var n=e.shift();"function"==typeof n?i(n()).done(function(n){o.push(n),t(e)}):(o.push(n),t(e))}var e,s=new i,o=[];return e=Array.isArray(arguments[0])?arguments[0]:n.toArray(arguments),t(e),s},window.Promise=i;var s=function(){this._storage=chrome.storage.local,this._options={},this._default={dictionary_enabled:!0,double_click_translate_enabled:!0,show_tooltip_enabled:!0,input_translate_enabled:!1,conversion_notification_disabled:!1,conversion_notification_last:0,conversion_notification_type:1};var t=this;chrome.storage.onChanged.addListener(function(e,n){if("local"===n)for(var i in e)t._options[i]=e[i].newValue}),this.isDictionaryEnabled=function(){return t.get("dictionary_enabled")},this.isTranslateEnabled=function(e){return!!t.isDictionaryEnabled()&&("input"!==e||t.get("input_translate_enabled"))},this.isDoubleClickTranslateEnabled=function(e){return!!t.isTranslateEnabled(e)&&t.get("double_click_translate_enabled")},this.isShowTooltipEnabled=function(){return!!t.isDictionaryEnabled()&&t.get("show_tooltip_enabled")}};s.prototype={load:function(){var t=new i,e=this;return this._storage.get(null,function(n){e._options=n,t.resolve(n)}),t},set:function(t,e){var n={};"string"!=typeof t&&"number"!=typeof t||void 0===e||(n[t]=e,this._options[t]=e,this._storage.set(n))},get:function(t){return t in this._options?this._options[t]:this._default[t]}},window.Options=s,chrome.metricsPrivate||(chrome.metricsPrivate={recordSmallCount:console.warn.bind(console,"Metrics.recordCount:"),recordTime:console.warn.bind(console,"Metrics.recordTime:"),recordCustomData:console.warn.bind(console,"Metric.recordCustomData:")}),["recordSmallCount","recordTime"].forEach(function(t){var e=chrome.metricsPrivate[t];e&&(chrome.metricsPrivate[t]=function(){var t=Array.prototype.slice.call(arguments);return t[0]="Dictionary."+t[0],e.apply(this,t)})}),window.metrics=chrome.metricsPrivate,metrics.POPUP_OPENED_SELECTION=10,metrics.POPUP_OPENED_DOUBLECLICK=11,metrics.POPUP_OPENED_CONTEXTMENU=12,metrics.POPUP_OPENED_NOTENPAGE=13,metrics.POPUP_OPENED_ENPAGE=14,metrics.POPUP_OPENED_DEFAULTSIZE=15,metrics.POPUP_OPENED_SCROLLSIZE=16,metrics.POPUP_ACTION_SPEAKER=0,metrics.POPUP_ACTION_OPENLINK=1,metrics.POPUP_ACTION_SYNONYM=2,metrics.POPUP_ACTION_SCROLL=3,metrics.CONVERSION_ONBOARDING_ALREADY=1,metrics.CONVERSION_ONBOARDING_TRY=2;var o,r=chrome.i18n.getMessage;chrome.storage?(o=new s,metrics=chrome.extension.getBackgroundPage().metrics):o={dictionary_enabled:!0,double_click_translate_enabled:!0,show_tooltip_enabled:!0,input_translate_enabled:!1,get:function(t){return this[t]},load:function(){return{done:function(t){t()}}},set:function(){console.log("set",arguments[0],"to",arguments[1])}},o.load().done(function(){function t(){var t={isDictionaryEnabled:o.get("dictionary_enabled"),isDoubleClickTranslateEnabled:o.get("double_click_translate_enabled"),isShowTooltipEnabled:o.get("show_tooltip_enabled"),isInInputTranslateEnabled:o.get("input_translate_enabled"),i18n_options_title:r("options_title"),i18n_master_switch:r("options_master_switch"),i18n_double_click_translate:r("options_double_click_translate"),i18n_show_tooltip:r("options_show_tooltip"),i18n_input_translate:r("options_input_translate")},e=n.query("#options-template").textContent;i.innerHTML=Mustache.render(e,t)}function e(t){var e=n.queryAll(".checkbox");if(e&&e.length)if(t)for(i=0;i<e.length;i++)e[i].classList.remove("disabled");else for(var i=0;i<e.length;i++)e[i].classList.add("disabled")}var i=n.query("#options");t(),i.addEventListener("click",function(t){var n=t.target;switch("close-button"===n.id&&window.close(),n.getAttribute("id")){case"dictionary-enable":o.set("dictionary_enabled",!!n.checked),e(!!n.checked);break;case"double-click-translate":o.set("double_click_translate_enabled",!!n.checked);break;case"show-tooltip":o.set("show_tooltip_enabled",!!n.checked);break;case"input-translate":o.set("input_translate_enabled",!!n.checked)}},!1),window.addEventListener("focus",function(){t()},!1)})}("undefined"==typeof global?global={}:global);